define(["modules/jquery-mozu","hyprlive","underscore","modules/backbone-mozu","modules/models-faceting","modules/views-productlists","modules/views-paging","modules/bazaar-voice","modules/api","hyprlivecontext"],function(e,t,a,n,r,i,o,s,d,c){function u(e){return e.totalCount}function l(e){return e}var m,g={"price asc":function(e,t){var a=e.get("price.price"),n=t.get("price.price");return a>n?1:a===n?0:n>a?-1:void 0},"price desc":function(e,t){var a=e.get("price.price"),n=t.get("price.price");return n>a?1:a===n?0:a>n?-1:void 0}},p={},f=t.getThemeSetting("useAnimatedProductLists")&&!Modernizr.mq("(max-width: 480px)"),w=c.locals.themeSettings,v=r.FacetedProductCollection.extend({sortBy:function(t){return this.get("items").comparator=g[t],this.apiGet(e.extend(this.lastRequest,{sortBy:t}))}});m=new Date((new Date).setDate((new Date).getDate()-w.numberOfDaysNew)).toISOString(),e(document).ready(function(){var r=e("[data-mz-newarrivals]"),c=new v({});c.baseRequestParams=c.lastRequest={filter:"createDate gt "+m,sortBy:"createDate desc",pageSize:"3"},e.extend(p,{pagingControls:new o.PagingControls({el:r.find("[data-mz-pagingcontrols]"),model:c}),pageNumbers:new o.TopScrollingPageNumbers({el:r.find("[data-mz-pagenumbers]"),model:c}),pageSort:new o.PageSortView({el:r.find("[data-mz-pagesort]"),model:c}),productList:f?new i.AnimatedList({el:r.find("[data-mz-productlist] .mz-productlist-list"),model:c}):new i.List({el:r.find("[data-mz-productlist]"),model:c})}),n.history.start({pushState:!0,root:window.location.pathname});var g=new n.Router,z=!1;c.on("facetchange",function(e){z||g.navigate(e),z=!1},g),c.on("change:pageSize",c.updateFacets,c);var h=t.getThemeSetting("defaultPageSize");return g.route("*all","filter",function(){{var t=e.extend({pageSize:h},e.deparam()),n={};c.lastRequest}t.startIndex||(n.resetIndex=!0),c.set(a.pick(t,"pageSize","startIndex","facetValueFilter","sortBy","categoryId"),{silent:!0}),z=!0,c.updateFacets(n)}),a.invoke(p,"delegateEvents"),c.updateFacets(),c.on("sync",function(t,a){if(0===e("[data-mz-newarrivals]").prop("style").length&&r.noFlickerFadeIn(),0===t.startIndex){{var n=w.minNumberOfNewArrivals-(w.includeOutOfStock?t.totalCount:u(t));w.includeOutOfStock?n:4*n}"number"!=typeof a&&(a=0),n>0&&d.get("search",{sortBy:"createDate desc",startIndex:0,pageSize:w.minNumberOfNewArrivals}).then(function(e){var t=l(e.data.items);c.get("items").add(t),c.trigger("sync",c.toJSON(),0),r.find("[data-mz-pagingcontrols]").hide(),r.find("[data-mz-pagenumbers]").hide()})}}),s.productSummary('[data-mz-role="product-listing-review"]'),window.facetingViews=p,p})});